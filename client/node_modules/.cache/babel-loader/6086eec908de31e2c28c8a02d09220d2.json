{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"C:/Users/YAMATO/Desktop/LostItemTracking/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/YAMATO/Desktop/LostItemTracking/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/YAMATO/Desktop/LostItemTracking/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{Fragment,useState}from'react';import Message from'./Message';import Progress from'./Progress';import DateTime from'./DateTime';import Description from'./Description';import ContactWay from'./ContactWay';import axios from'axios';var ReportForm=function ReportForm(){// File Object\nvar _useState=useState(''),_useState2=_slicedToArray(_useState,2),file=_useState2[0],setFile=_useState2[1];// File Name\nvar _useState3=useState('請選擇要上傳的照片'),_useState4=_slicedToArray(_useState3,2),fileName=_useState4[0],setFileName=_useState4[1];// Photo Description\nvar _useState5=useState('例: 本人於今天早上9時遺失一個錢包...'),_useState6=_slicedToArray(_useState5,2),photoDesc=_useState6[0],setPhotoDesc=_useState6[1];// The way to contact\nvar _useState7=useState('12345678/abc@example.com...'),_useState8=_slicedToArray(_useState7,2),contactWay=_useState8[0],setContactWay=_useState8[1];// Is it found or lost item? 0 = lost, 1 = found\nvar _useState9=useState('拾獲'),_useState10=_slicedToArray(_useState9,2),option=_useState10[0],setOption=_useState10[1];// Time finding or losing\nvar _useState11=useState(new Date()),_useState12=_slicedToArray(_useState11,2),dateTime=_useState12[0],setDateTime=_useState12[1];// Uploaded File\nvar _useState13=useState({}),_useState14=_slicedToArray(_useState13,2),uploadedFile=_useState14[0],setUploadedFile=_useState14[1];// Message\nvar _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),message=_useState16[0],setMessage=_useState16[1];// Upload Progress\nvar _useState17=useState(0),_useState18=_slicedToArray(_useState17,2),uploadPercent=_useState18[0],setUploadPercent=_useState18[1];// Change Function\nvar onChangeFile=function onChangeFile(e){setFile(e.target.files[0]);setFileName(e.target.files[0].name);};var onChangePhotoDesc=function onChangePhotoDesc(e){setPhotoDesc(e);};var onChangeContactWay=function onChangeContactWay(e){setContactWay(e);};var onChangeOption=function onChangeOption(e){setOption(e.target.value);};var onChangeDateTime=function onChangeDateTime(e){setDateTime(e);};var resetForm=function resetForm(){setFile('');setFileName('請選擇要上傳的照片');setPhotoDesc('例: 本人於今天早上9時遺失一個錢包...');setContactWay('12345678/abc@example.com...');setOption('拾獲');};var doUploadDetail=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var opt,ts,fileID,response,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(photoDesc===''||photoDesc===null)){_context.next=2;break;}return _context.abrupt(\"return\");case 2:if(!(contactWay===''||contactWay===null)){_context.next=4;break;}return _context.abrupt(\"return\");case 4:console.log('uploadDetail is called.');// convert text to int before upload to db.\nopt=option==='拾獲'?1:0;// convert date time to timestamp before upload to db.\nts=new Date(dateTime).getTime()/1000;fileID=-1;_context.prev=8;_context.next=11;return fetch('/api/addReport',{method:'post',headers:{'Accept':'application/json','Content-Type':'application/json'},body:JSON.stringify({option:opt,timestamp:ts,description:photoDesc,contact:contactWay})});case 11:response=_context.sent;_context.next=14;return response.json();case 14:result=_context.sent;if(result&&result.success===true){fileID=result.id;console.log(fileID);}else{setMessage(result.msg);fileID=-1;}_context.next=22;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](8);console.log(_context.t0);resetForm();case 22:return _context.abrupt(\"return\",fileID);case 23:case\"end\":return _context.stop();}}},_callee,null,[[8,18]]);}));return function doUploadDetail(){return _ref.apply(this,arguments);};}();var onSubmitForm=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var fID,formData,res,_res$data,_fileName,filePath;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();// Upload Detail to database & Assign File ID.\nfID=doUploadDetail();// Detail is uploaded to db successfully.\nconsole.log(fID);if(!(fID!==-1)){_context2.next=21;break;}formData=new FormData();formData.append('file',file);_context2.prev=6;_context2.next=9;return axios.post('/api/upload',formData,{headers:{'Content-Type':'multiport/form-data'},onUploadProgress:function onUploadProgress(progressEvent){setUploadPercent(parseInt(Math.round(progressEvent.loaded*100/progressEvent.total)));// Clear Percentage after 10s.\nsetTimeout(function(){return setUploadPercent(0);},3000);}});case 9:res=_context2.sent;console.log(res.data);_res$data=res.data,_fileName=_res$data.fileName,filePath=_res$data.filePath;setUploadedFile({fileName:_fileName,filePath:filePath});// console.log(uploadedFile);\nsetMessage('File Uploaded!');_context2.next=19;break;case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](6);if(_context2.t0.response.status===500){setMessage('There is a problem with the server. Please try again later');}else{setMessage(_context2.t0.response.data.msg);}case 19:_context2.next=22;break;case 21:setMessage('There is a problem uploading detail. Please try again later');case 22:case\"end\":return _context2.stop();}}},_callee2,null,[[6,16]]);}));return function onSubmitForm(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Fragment,{children:[message?/*#__PURE__*/_jsx(Message,{msg:message}):null,/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmitForm,children:[/*#__PURE__*/_jsxs(\"div\",{onChange:onChangeOption,children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u8ACB\\u9078\\u64C7\\u56DE\\u5831\\u985E\\u578B:\\xA0\"}),/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"\\u62FE\\u7372\",checked:option==='拾獲'}),\" \\u62FE\\u7372\\xA0\\xA0\",/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"\\u907A\\u5931\",checked:option==='遺失'}),\" \\u907A\\u5931\\xA0\\xA0\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"multiline mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-mb-4\",children:[option,\"\\u6642\\u9593:\"]}),/*#__PURE__*/_jsx(DateTime,{onChange:onChangeDateTime,option:option})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Description,{description:photoDesc,onChange:onChangePhotoDesc})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(ContactWay,{contact:contactWay,onChange:onChangeContactWay})}),/*#__PURE__*/_jsx(\"br\",{}),uploadPercent>0?/*#__PURE__*/_jsx(Progress,{percentage:uploadPercent}):null,/*#__PURE__*/_jsxs(\"div\",{className:\"custom-file mb-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",className:\"custom-file-input\",id:\"customFile\",onChange:onChangeFile}),/*#__PURE__*/_jsx(\"label\",{className:\"custom-file-label\",htmlFor:\"customFile\",children:fileName})]}),/*#__PURE__*/_jsx(\"input\",{type:\"submit\",value:\"\\u56DE\\u5831\",className:\"btn btn-primary btn-block mt-4\"})]}),uploadedFile.fileName?/*#__PURE__*/_jsx(\"div\",{className:\"row mt-5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6 m-auto\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-center\",children:[\"\\u6A94\\u6848: \",uploadedFile.fileName]}),/*#__PURE__*/_jsx(\"img\",{style:{width:'100%'},src:uploadedFile.filePath,alt:\"\"})]})}):null]});};export default ReportForm;","map":{"version":3,"sources":["C:/Users/YAMATO/Desktop/LostItemTracking/client/src/components/ReportForm.js"],"names":["React","Fragment","useState","Message","Progress","DateTime","Description","ContactWay","axios","ReportForm","file","setFile","fileName","setFileName","photoDesc","setPhotoDesc","contactWay","setContactWay","option","setOption","Date","dateTime","setDateTime","uploadedFile","setUploadedFile","message","setMessage","uploadPercent","setUploadPercent","onChangeFile","e","target","files","name","onChangePhotoDesc","onChangeContactWay","onChangeOption","value","onChangeDateTime","resetForm","doUploadDetail","console","log","opt","ts","getTime","fileID","fetch","method","headers","body","JSON","stringify","timestamp","description","contact","response","json","result","success","id","msg","onSubmitForm","preventDefault","fID","formData","FormData","append","post","onUploadProgress","progressEvent","parseInt","Math","round","loaded","total","setTimeout","res","data","filePath","status","width"],"mappings":"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","sourcesContent":["import React, { Fragment, useState } from 'react';\r\nimport Message from './Message';\r\nimport Progress from './Progress';\r\nimport DateTime from './DateTime';\r\nimport Description from './Description';\r\nimport ContactWay from './ContactWay';\r\nimport axios from 'axios';\r\n\r\nconst ReportForm = () => {\r\n\r\n\t// File Object\r\n\tconst [file, setFile] = useState('');\r\n\t// File Name\r\n\tconst [fileName, setFileName] = useState('請選擇要上傳的照片');\r\n\t// Photo Description\r\n\tconst [photoDesc, setPhotoDesc] = useState('例: 本人於今天早上9時遺失一個錢包...');\r\n\t// The way to contact\r\n\tconst [contactWay, setContactWay] = useState('12345678/abc@example.com...');\r\n\t// Is it found or lost item? 0 = lost, 1 = found\r\n\tconst [option, setOption] = useState('拾獲');\r\n\t// Time finding or losing\r\n\tconst [dateTime, setDateTime] = useState(new Date());\r\n\t// Uploaded File\r\n\tconst [uploadedFile, setUploadedFile] = useState({});\r\n\t// Message\r\n\tconst [message, setMessage] = useState('');\r\n\t// Upload Progress\r\n\tconst [uploadPercent, setUploadPercent] = useState(0);\r\n\r\n\t// Change Function\r\n\tconst onChangeFile = (e) => {\r\n\t\tsetFile(e.target.files[0]);\r\n\t\tsetFileName(e.target.files[0].name);\r\n\t}\r\n\r\n\tconst onChangePhotoDesc = (e) => {\r\n\t\tsetPhotoDesc(e);\r\n\t}\r\n\r\n\tconst onChangeContactWay = (e) => {\r\n\t\tsetContactWay(e);\r\n\t}\r\n\r\n\tconst onChangeOption = (e) => {\r\n\t\tsetOption(e.target.value);\r\n\t}\r\n\r\n\tconst onChangeDateTime = (e) => {\r\n\t\tsetDateTime(e);\r\n\t}\r\n\r\n\tconst resetForm = () => {\r\n\t\tsetFile('');\r\n\t\tsetFileName('請選擇要上傳的照片');\r\n\t\tsetPhotoDesc('例: 本人於今天早上9時遺失一個錢包...');\r\n\t\tsetContactWay('12345678/abc@example.com...');\r\n\t\tsetOption('拾獲');\r\n\t}\r\n\r\n\tconst doUploadDetail = async() => {\r\n    if(photoDesc === '' || photoDesc === null) {\r\n      return;\r\n    }\r\n    if(contactWay === '' || contactWay === null) {\r\n      return;\r\n\t\t}\r\n\t\tconsole.log('uploadDetail is called.');\r\n\t\t\r\n\t\t// convert text to int before upload to db.\r\n\t\tlet opt = (option === '拾獲') ? 1 : 0;\r\n\r\n\t\t// convert date time to timestamp before upload to db.\r\n\t\tlet ts = new Date(dateTime).getTime()/1000;\r\n\r\n\t\tlet fileID = -1;\r\n\r\n    try {\r\n      let response = await fetch('/api/addReport', {\r\n        method: 'post',\r\n        headers: {\r\n          'Accept':'application/json',\r\n          'Content-Type':'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n\t\t\t\t\toption: opt,\r\n      \t\ttimestamp: ts,\r\n      \t\tdescription: photoDesc,\r\n      \t\tcontact: contactWay\r\n        })\r\n      });\r\n\r\n      let result = await response.json();\r\n      if(result && result.success === true) {\r\n\t\t\t\tfileID = result.id;\r\n\t\t\t\tconsole.log(fileID);\r\n      }\r\n      else {\r\n\t\t\t\tsetMessage(result.msg);\r\n\t\t\t\tfileID = -1;\r\n      }\r\n    }\r\n    catch(e) {\r\n      console.log(e);\r\n      resetForm();\r\n\t\t}\r\n\t\treturn fileID;\r\n  }\r\n\r\n\tconst onSubmitForm = async (e) => {\r\n\t\te.preventDefault();\r\n\t\t// Upload Detail to database & Assign File ID.\r\n\t\tlet fID = doUploadDetail();\r\n\t\t// Detail is uploaded to db successfully.\r\n\t\tconsole.log(fID);\r\n\t\tif(fID !== -1) {\r\n\t\t\tconst formData = new FormData();\r\n\t\t\tformData.append('file', file);\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await axios.post('/api/upload', formData, {\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t'Content-Type': 'multiport/form-data'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonUploadProgress: progressEvent => {\r\n\t\t\t\t\t\tsetUploadPercent(parseInt(Math.round((progressEvent.loaded * 100) /\r\n\t\t\t\t\t\tprogressEvent.total)));\r\n\r\n\t\t\t\t\t\t// Clear Percentage after 10s.\r\n\t\t\t\t\t\tsetTimeout(() => setUploadPercent(0), 3000);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t\tconsole.log(res.data);\r\n\t\t\t\tconst { fileName, filePath } = res.data;\r\n\t\t\t\tsetUploadedFile({ fileName, filePath });\r\n\t\t\t\t// console.log(uploadedFile);\r\n\t\t\t\tsetMessage('File Uploaded!');\r\n\t\t\t}\r\n\t\t\tcatch (err) {\r\n\t\t\t\tif(err.response.status === 500) {\r\n\t\t\t\t\tsetMessage('There is a problem with the server. Please try again later');\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tsetMessage(err.response.data.msg);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} \r\n\t\telse {\r\n\t\t\tsetMessage('There is a problem uploading detail. Please try again later');\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t{ message? <Message msg={message} /> : null }\r\n\t\t\t<form onSubmit={onSubmitForm}>\r\n\t\t\t\t<div onChange={onChangeOption}>\r\n\t\t\t\t\t<label>請選擇回報類型:&nbsp;</label>\r\n\t\t\t\t\t<input type='radio' value='拾獲' checked={option === '拾獲'}/> 拾獲&nbsp;&nbsp;\r\n\t\t\t\t\t<input type='radio' value='遺失' checked={option === '遺失'}/> 遺失&nbsp;&nbsp;\r\n\t\t\t\t\t\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"multiline mb-4\">\r\n\t\t\t\t\t<div className=\"col-mb-4\">{option}時間:</div>\r\n      \t\t\t<DateTime\tonChange={onChangeDateTime} option={option} />\r\n    \t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<Description description={photoDesc} \r\n\t\t\t\t\t\tonChange={onChangePhotoDesc}/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<br/>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<ContactWay \r\n\t\t\t\t\t\tcontact={contactWay}\r\n\t\t\t\t\t\tonChange={onChangeContactWay}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<br/>\r\n\t\t\t\t{ uploadPercent > 0 ?\r\n\t\t\t\t\t<Progress percentage={uploadPercent} /> \r\n\t\t\t\t: null }\r\n\t\t\t\t<div className='custom-file mb-4'>\r\n\t\t\t\t\t<input type='file' className='custom-file-input' id='customFile' onChange={onChangeFile}/>\r\n\t\t\t\t\t<label className='custom-file-label' htmlFor='customFile'>\r\n\t\t\t\t\t\t{fileName}\r\n\t\t\t\t\t</label>\r\n\t\t\t\t</div>\r\n\t\t\t\t<input type='submit' value='回報' className=\"btn btn-primary btn-block mt-4\"/>\r\n\t\t\t</form>\r\n\t\t\t{ uploadedFile.fileName ? \r\n\t\t\t\t<div className='row mt-5'>\r\n\t\t\t\t\t<div className='col-md-6 m-auto'>\r\n\t\t\t\t\t\t<h3 className=\"text-center\">檔案: { uploadedFile.fileName }</h3>\r\n\t\t\t\t\t\t{/* <h4 className=\"text-left\">回報類型: { uploadedFile.option }物件</h4>\r\n\t\t\t\t\t\t<h4 className=\"text-left\">回報時間: { uploadedFile.dateTime }</h4>\r\n\t\t\t\t\t\t<h4 className=\"text-left\">物件形容: { uploadedFile.photoDesc }</h4>\r\n\t\t\t\t\t\t<h4 className=\"text-left\">聯絡方式: { uploadedFile.contactWay }</h4> */}\r\n\t\t\t\t\t\t{/* <h3 className=\"text-center\">{ uploadedFile.fileName }</h3> */}\r\n\t\t\t\t\t\t<img style={{ width: '100%' }} src={uploadedFile.filePath} alt='' />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div> \r\n\t\t\t\t: null }\r\n\t\t</Fragment>\r\n\t);\r\n};\r\n\r\nexport default ReportForm;"]},"metadata":{},"sourceType":"module"}